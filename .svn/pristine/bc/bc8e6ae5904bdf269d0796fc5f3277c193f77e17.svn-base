#encoding:utf-8
require 'net/http'
require 'uri'
require 'nokogiri'

def uri()
    url      = "http://192.168.10.9"
    port     = 8092
    content  = "userid.txt"
    uri_addr = "#{url}:#{port}/#{content}"
    uri      = URI(uri_addr)
end

def get
    Net::HTTP.get(uri) # => String
end

def post(uri, data)

    res = Net::HTTP.start(uri.hostname, uri.port) do |http|
        http.request_post(uri, data)
        # http.request_post(uri, str) { |response|
        #     response['content-type']
        #     p response.code_type
        #     response.read_body do |str| # read body now
        #         str
        #     end
        # }
    end
end

# user login
# curl http://192.168.10.9:8092/index.php/Oauth/authorize -d
# "username=18986681621
# &encrypt_pwd=9b44e764fb94a12bd799b761ea7db865cb4ab6cbce9a72c8251fcdfcbbe626d7a9fc02a50f124ae3f133ad9aaf4455884f0462b20cd251ebd09298dc1920305a3ed90a242813bd4f8a6c55f9d65072ed6eac723292d6327b9fa0f907ce735d1fbe6ea919010b504b5111ec962cf63299a660a4febdafa9856a7c55c6b70604fe
# &redirect_uri=http://192.168.10.9/oauthcli/index.php/Login/index
# &secret=qItiMyKZJtJcggm9YSnqwhMj8li8hJe7
# &response_type=code
# &client_id=160518183738"
def data_user_login(url, port, content, usr, pw, redirect_uri, secret, client_id, response_type="code")
    url         = "http://192.168.10.9"
    port        = 8092
    content     = "index.php/Oauth/authorize"
    uri_addr    = "#{url}:#{port}/#{content}"
    username    = "13760281579" #注册用户名
    encrypt_pwd = "9c76736d8a993299e155c797861d14ef7cd3507c900527e11da5d3357872ba9fb9e2db9511fe2bfafe7a6d4c6f8efdac40425414639e4815069c380c86ef4a7dd121e7db0418919a3ca8de77d745269ad19ea117154411df35f840eb1af5e82383c2d6dc627b3654f15596959e1643707995e9ef3db2847c0ca60de50ac43fc0" #用户密码，通过md5计算得出
    redirect_uri= "http://192.168.10.9:8083/oauthcli/index.php/Login/index" #写死
    data        = "username=18986681621\
&encrypt_pwd=9b44e764fb94a12bd799b761ea7db865cb4ab6cbce9a72c8251fcdfcbbe626d7a9fc02a50f124ae3f133ad9aaf4455884f0462b20cd251ebd09298dc1920305a3ed90a242813bd4f8a6c55f9d65072ed6eac723292d6327b9fa0f907ce735d1fbe6ea919010b504b5111ec962cf63299a660a4febdafa9856a7c55c6b70604fe\
&redirect_uri=http://192.168.10.9/oauthcli/index.php/Login/index\
&secret=qItiMyKZJtJcggm9YSnqwhMj8li8hJe7\
&response_type=#{response_type}\
&client_id=160518183738"
end

def doc(html)
    doc = Nokogiri::HTML(html)
end

def parse_html(html)
    doc = doc(html)
    doc.css("form input").each do |input|
        name_attr = input.attributes["name"]
        next if name_attr.nil?
        name_cont = name_attr.content
        if name_cont=="user_id"
            p input.attributes["value"].content
        end
    end
end
# {
#     "result":1,
#     "name":"admin@zhilutec.com",
#     "nickname":"\u552f\u4e00\u77e5\u8def\u8d85\u7ea7\u7ba1\u7406\u5458",
#     "uid":"1",
#     "role_code":"1",
#     "token":"34d5aeb4b075ef65f6aa156f202127e4"
# }
# {
#     "err_code": 10006,
#     "err_msg": "帐号或密码错误"
# }
def data_admin_login
    # curl -X POST http://192.168.10.9:8092/admins/dologin -d 'name=admin@zhilutec.com&password=123123'
end

def get_app_list
    # curl -X GET "http://192.168.10.9:8091/apps?admin_id=1&token=f816eabf9964b995313948a0d6c4c085" #// 查询全部
end


